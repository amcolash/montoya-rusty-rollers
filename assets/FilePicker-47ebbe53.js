import{s as F,m as S,b as D,p as C,o as r,F as P,h as y,T as _,_ as x,I as v,c as T,d as j,a as B,f as N,g as I,i as U,j as E,k as H,S as L,l as O,n as z,q as A,r as J,t as W}from"./index-c5ccc1b7.js";import{u as G,g as M,r as $,d as q}from"./firebase_storage-4f68f3a5.js";import"./firebase_database-4955b4c5.js";import"./firebase_app-23be643a.js";import"./firebase_auth-f63cb495.js";const V=F({display:"flex",flexDirection:"column",maxHeight:"90vh",width:"85vw",background:"var(--light)",position:"relative"},S({maxWidth:D},{width:"100vw",height:"100dvh",maxHeight:"100dvh"}));function Y(o){return C(()=>{const s=n=>{n.key==="Escape"&&o.onClose()};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[]),r("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100vw",height:"100dvh",position:"absolute",top:0,left:0,background:"rgba(0,0,0,0.5)",zIndex:10},onMouseDown:s=>{s.target===s.currentTarget&&(o.onClose(),s.stopPropagation(),s.preventDefault())},children:r("div",{className:V,children:[r("div",{style:{display:"flex",justifyContent:"center",position:"relative",background:"var(--dark)",color:"var(--light)",padding:"0.5rem"},children:[r("h3",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.5rem"},children:o.title}),r("button",{onClick:()=>o.onClose(),style:{position:"absolute",right:"0.5rem",background:"none",border:"none"},children:r(P,{})})]}),r("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:o.children})]})})}function K(o,s,n,i){function a(e){return e instanceof n?e:new n(function(d){d(e)})}return new(n||(n=Promise))(function(e,d){function m(c){try{t(i.next(c))}catch(g){d(g)}}function f(c){try{t(i.throw(c))}catch(g){d(g)}}function t(c){c.done?e(c.value):a(c.value).then(m,f)}t((i=i.apply(o,s||[])).next())})}function Q(o,s){var n={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,a,e,d;return d={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function m(t){return function(c){return f([t,c])}}function f(t){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,a&&(e=t[0]&2?a.return:t[0]?a.throw||((e=a.return)&&e.call(a),0):a.next)&&!(e=e.call(a,t[1])).done)return e;switch(a=0,e&&(t=[t[0]&2,e.value]),t[0]){case 0:case 1:e=t;break;case 4:return n.label++,{value:t[1],done:!1};case 5:n.label++,a=t[1],t=[0];continue;case 7:t=n.ops.pop(),n.trys.pop();continue;default:if(e=n.trys,!(e=e.length>0&&e[e.length-1])&&(t[0]===6||t[0]===2)){n=0;continue}if(t[0]===3&&(!e||t[1]>e[0]&&t[1]<e[3])){n.label=t[1];break}if(t[0]===6&&n.label<e[1]){n.label=e[1],e=t;break}if(e&&n.label<e[2]){n.label=e[2],n.ops.push(t);break}e[2]&&n.ops.pop(),n.trys.pop();continue}t=s.call(o,n)}catch(c){t=[6,c],a=0}finally{i=e=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}var X=function(){var o=y(),s=o[0],n=o[1],i=y(!1),a=i[0],e=i[1],d=y(),m=d[0],f=d[1],t=_(function(c,g,k){return K(void 0,void 0,void 0,function(){return Q(this,function(w){return[2,new Promise(function(h,l){e(!0),n(void 0);var p=G(c,g,k);p.on("state_changed",function(u){f(u)},function(u){e(!1),n(u),h(void 0)},function(){e(!1),f(void 0),h({metadata:p.snapshot.metadata,ref:p.snapshot.ref})})})]})})},[]);return[t,a,m,s]};const Z=F({$nest:{"&::file-selector-button":{marginRight:"20px",padding:"0.5rem 1rem",background:"var(--cta)",border:"1px solid var(--cta-border)",borderRadius:"0.25rem",color:"white",cursor:"pointer",transition:"background .2s ease-in-out"},"&::file-selector-button:hover":{background:"var(--cta-hover)"}}});function ee(o){const s=M(B),n=x(null),[i,a]=y(),[e,d,m,f]=X();return r("div",{style:{display:"flex",justifyContent:"center"},children:r("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexWrap:"wrap",gap:"1rem",margin:"1rem"},children:[r("div",{children:r("input",{id:"file",type:"file",accept:"image/*",ref:n,onChange:t=>{const c=t.target.files?t.target.files[0]:void 0;a(c)},className:Z,disabled:d})}),r(v,{icon:r(T,{}),disabled:d||!i,onClick:async()=>{if(i){const t=$(s,"images/"+i.name);try{await e(t,i,{contentType:i.type}),setTimeout(()=>{n.current&&(n.current.value=""),a(void 0)},3e3)}catch(c){console.error(c)}o.reloadFiles()}},children:"Upload Image"}),d&&r(j,{})]})})}const te=F({width:"10rem",height:"10rem",padding:"0.25rem",marginBottom:"0.5rem",background:"transparent",border:"1px solid",borderRadius:"0.5rem",$nest:{"&:hover":{background:"lightgrey"},"& img":{width:"100%",height:"100%",objectFit:"cover",borderRadius:"0.5rem"}}});function ne(o){const s=x(null),[n,i]=N("images/",o.reloadCounter),[a,e]=I.use(),[d,m]=y(!1);if(!a)return null;const[f,t,c,g,k]=U(a.ref),[w,h]=y([]);return C(()=>{if(!f||!a.multi){h([]);return}try{const l=JSON.parse(f||"");h(l)}catch(l){console.error(l),h([])}},[f]),r("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[r("div",{style:{borderBottom:"1px solid #bbb",width:"80%",margin:"0 0 1rem",textAlign:"center"}}),!i&&n.length>0&&a.multi&&r(v,{icon:r(E,{}),buttonType:"success",onClick:()=>{g(JSON.stringify(w)),e(void 0)},style:{margin:"0.75rem"},disabled:!d||k,children:"Save Selected Images"}),r("div",{ref:s,style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:"1rem"},children:[i&&r("div",{children:"Loading Images..."}),!i&&n.length===0&&r("div",{children:"No Images Have Been Uploaded"}),!i&&n.map(l=>{const p=x(null);return r("div",{style:{display:"flex",flexDirection:"column"},children:[r("button",{className:te,onClick:u=>{a.multi&&p.current?p.current.click():(g(JSON.stringify({url:H(l.path,L.Large,!0),itemPath:l.ref.fullPath})),e(void 0))},style:{position:"relative"},title:l.name,children:[a.multi&&r("input",{type:"checkbox",ref:p,onClick:u=>{u.stopPropagation(),m(!0),h(b=>u.target.checked?[...b,{url:l.url,thumbnail:l.thumbnail,itemPath:l.ref.fullPath}]:b.filter(R=>R.url!==l.url))},style:{position:"absolute",top:"0.25rem",right:"0.25rem"},"data-url":l.url,"data-thumbnail":l.thumbnail,"data-item-path":l.ref.fullPath,checked:w.some(u=>u.url===l.url)}),r("img",{src:l.thumbnail,loading:"lazy",onError:u=>setTimeout(()=>{u.target.src="",u.target.src=l.thumbnail},1500)})]}),r("div",{style:{display:"flex",gap:"0.25rem"},children:[r(v,{icon:r(O,{}),onClick:()=>window.open(l.url,"_blank"),style:{width:"100%",padding:"0.25rem"},title:"Download Image"}),r(v,{icon:r(z,{}),buttonType:"destructive",onClick:async()=>{if(confirm("Are you sure you want to delete this image?")){const u=A(l.ref);await Promise.all(u.map(b=>q(b))),o.setReloadCounter(o.reloadCounter+1)}},style:{width:"100%",padding:"0.25rem"},title:"Delete Image"})]})]},l.url)})]})]})}function se(){const[o,s]=I.use(),[n,i]=y(0);return o?r(Y,{title:r(J,{children:["Choose an Image ",r(W,{})]}),onClose:()=>s(void 0),children:[r(ee,{reloadFiles:()=>i(()=>n+1)}),r(ne,{reloadCounter:n,setReloadCounter:i})]}):null}export{se as FilePicker};
