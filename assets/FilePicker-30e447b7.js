import{p as _,o as r,i as S,h as m,T as D,b as I,_ as P,I as b,j as T,l as j,c as w,C as F,f as R,m as A,n as U,q as E,t as B,a as L,v as N}from"./index-c4673b1f.js";import{u as O,g as C,r as p,l as $,d as q}from"./firebase_storage-33352761.js";import"./firebase_database-12542b98.js";import"./firebase_app-08d7da12.js";function G(a){return _(()=>{const l=e=>{e.key==="Escape"&&a.onClose()};return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[]),r("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100vw",height:"100vh",position:"absolute",top:0,left:0,background:"rgba(0,0,0,0.5)",zIndex:50},onMouseDown:l=>{l.target===l.currentTarget&&(a.onClose(),l.stopPropagation(),l.preventDefault())},children:r("div",{style:{width:"85vw",background:"var(--light)",position:"relative"},children:[r("div",{style:{display:"flex",justifyContent:"center",position:"relative",background:"var(--dark)",color:"var(--light)",padding:"0.5rem"},children:[r("h3",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.5rem"},children:a.title}),r("button",{onClick:()=>a.onClose(),style:{position:"absolute",right:"0.5rem",paddingTop:"0.2rem"},children:r(S,{})})]}),r("div",{style:{height:"85vh",overflowY:"auto"},children:a.children})]})})}function H(a,l,e,i){function s(t){return t instanceof e?t:new e(function(c){c(t)})}return new(e||(e=Promise))(function(t,c){function f(o){try{n(i.next(o))}catch(u){c(u)}}function g(o){try{n(i.throw(o))}catch(u){c(u)}}function n(o){o.done?t(o.value):s(o.value).then(f,g)}n((i=i.apply(a,l||[])).next())})}function J(a,l){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},i,s,t,c;return c={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function f(n){return function(o){return g([n,o])}}function g(n){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,s&&(t=n[0]&2?s.return:n[0]?s.throw||((t=s.return)&&t.call(s),0):s.next)&&!(t=t.call(s,n[1])).done)return t;switch(s=0,t&&(n=[n[0]&2,t.value]),n[0]){case 0:case 1:t=n;break;case 4:return e.label++,{value:n[1],done:!1};case 5:e.label++,s=n[1],n=[0];continue;case 7:n=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(n[0]===6||n[0]===2)){e=0;continue}if(n[0]===3&&(!t||n[1]>t[0]&&n[1]<t[3])){e.label=n[1];break}if(n[0]===6&&e.label<t[1]){e.label=t[1],t=n;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(n);break}t[2]&&e.ops.pop(),e.trys.pop();continue}n=l.call(a,e)}catch(o){n=[6,o],s=0}finally{i=t=0}if(n[0]&5)throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}var W=function(){var a=m(),l=a[0],e=a[1],i=m(!1),s=i[0],t=i[1],c=m(),f=c[0],g=c[1],n=D(function(o,u,h){return H(void 0,void 0,void 0,function(){return J(this,function(d){return[2,new Promise(function(v,X){t(!0),e(void 0);var x=O(o,u,h);x.on("state_changed",function(k){g(k)},function(k){t(!1),e(k),v(void 0)},function(){t(!1),g(void 0),v({metadata:x.snapshot.metadata,ref:x.snapshot.ref})})})]})})},[]);return[n,s,f,l]};const M=I({$nest:{"&::file-selector-button":{marginRight:"20px",padding:"0.5rem 1rem",background:"var(--cta)",border:"1px solid var(--cta-border)",color:"white",cursor:"pointer",transition:"background .2s ease-in-out"},"&::file-selector-button:hover":{background:"var(--cta-hover)"}}});function V(a){const l=C(w),e=P(null),[i,s]=m(),[t,c,f,g]=W();return r("div",{style:{display:"flex",justifyContent:"center"},children:r("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexWrap:"wrap",gap:"1rem",margin:"1rem"},children:[r("div",{children:r("input",{id:"file",type:"file",accept:"image/*",ref:e,onChange:n=>{const o=n.target.files?n.target.files[0]:void 0;s(o)},className:M,disabled:c})}),r(b,{icon:r(T,{}),disabled:c||!i,onClick:async()=>{if(i){const n=p(l,"images/"+i.name);try{await t(n,i,{contentType:i.type}),e.current&&(e.current.value=""),s(void 0)}catch(o){console.error(o)}a.reloadFiles()}},children:"Upload Image"}),c&&r(j,{})]})})}function Y(a,l){const[e,i]=m([]),[s,t]=m(!0),c=C(w),f=p(c,a);return _(()=>{t(!0),$(f).then(g=>{const n=[];for(const o of g.items){if(o.name.includes("200x200")||o.name.includes("400x400")||o.name.includes("1000x1000"))continue;const u=y(o,0),h=y(o,"_200x200");n.push({name:o.name,path:o.fullPath,url:u,thumbnail:h,ref:o})}i(n),t(!1)})},[l]),[e,s]}function y(a,l){const e=`https://firebasestorage.googleapis.com/v0/b/${a.bucket}/o/${encodeURIComponent(a.fullPath)}?alt=media`,i=e.lastIndexOf(".");if(!e.includes(".svg")){if(l==="_200x200")return e.slice(0,i)+"_200x200"+e.slice(i);if(l==="_400x400")return e.slice(0,i)+"_400x400"+e.slice(i);if(l==="_1000x1000")return e.slice(0,i)+"_1000x1000"+e.slice(i)}return e}function z(a){if(a.fullPath.includes(".svg"))return[a];const l=C(w);return[a,p(l,y(a,"_200x200")),p(l,y(a,"_400x400")),p(l,y(a,"_1000x1000"))]}const K=I({width:"10rem",height:"10rem",padding:"0.25rem",marginBottom:"0.5rem",background:"transparent",border:"1px solid",borderRadius:"0.5rem",$nest:{"&:hover":{background:"lightgrey"},"& img":{width:"100%",height:"100%",objectFit:"cover",borderRadius:"0.5rem"}}});function Q(a){const l=F.useRef(null),[e,i]=Y("images/",a.reloadCounter),[s,t]=R.use();if(!s)return null;const[c,f,g,n,o]=A(s.ref);return r("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[r("div",{style:{borderBottom:"1px solid #bbb",width:"80%",margin:"0 0 1rem",textAlign:"center"}}),!i&&e.length>0&&s.multi&&r(b,{icon:r(U,{}),buttonType:"success",onClick:async()=>{if(l.current){const u=l.current.querySelectorAll('input[type="checkbox"]'),h=Array.from(u).filter(d=>d.checked).map(d=>d.getAttribute("data-url"));n(JSON.stringify(h)),t(void 0)}},style:{margin:"0.75rem"},children:"Save Selected Images"}),r("div",{ref:l,style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:"1rem",padding:"0.75rem"},children:[i&&r("div",{children:"Loading Images..."}),!i&&e.length===0&&r("div",{children:"No Images"}),!i&&e.map(u=>{const h=F.useRef(null);return r("div",{style:{display:"flex",flexDirection:"column"},children:[r("button",{className:K,onClick:async()=>{s.multi&&h.current?h.current.checked=!h.current.checked:(n(u.url),t(void 0))},style:{position:"relative"},title:u.name,children:[s.multi&&r("input",{type:"checkbox",ref:h,onClick:d=>d.stopPropagation(),style:{position:"absolute",top:"0.25rem",right:"0.25rem"},"data-url":u.url,checked:JSON.parse(c||"").includes(u.url)}),r("img",{src:u.thumbnail,loading:"lazy",onError:d=>setTimeout(()=>{console.log(d),d.target.src="",d.target.src=u.thumbnail},1500)})]}),r("div",{style:{display:"flex",gap:"0.25rem"},children:[r(b,{icon:r(E,{}),onClick:()=>window.open(u.url,"_blank"),style:{width:"100%",padding:"0.25rem"},title:"Download Image"}),r(b,{icon:r(B,{}),buttonType:"destructive",onClick:async()=>{if(confirm("Are you sure you want to delete this image?")){const d=z(u.ref);await Promise.all(d.map(v=>q(v))),a.setReloadCounter(a.reloadCounter+1)}},style:{width:"100%",padding:"0.25rem"},title:"Delete Image"})]})]},u.url)})]})]})}function re(){const[a,l]=R.use(),[e,i]=m(0);return a?r(G,{title:r(L,{children:["Choose an Image ",r(N,{})]}),onClose:()=>l(void 0),children:[r(V,{reloadFiles:()=>i(()=>e+1)}),r(Q,{reloadCounter:e,setReloadCounter:i})]}):null}export{re as FilePicker};
