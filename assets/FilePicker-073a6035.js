import{s as F,p as R,o as n,F as D,h as y,T as _,_ as x,I as v,b as T,c as j,a as U,d as B,f as S,g as E,i as L,j as C,S as I,k as N,l as O,m as z,n as A,q as H}from"./index-b35c8238.js";import{u as J,g as G,r as M,d as W}from"./firebase_storage-4f68f3a5.js";import"./firebase_database-4955b4c5.js";import"./firebase_app-23be643a.js";import"./firebase_auth-f63cb495.js";F({});function $(o){return R(()=>{const s=r=>{r.key==="Escape"&&o.onClose()};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[]),n("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100vw",height:"100dvh",position:"absolute",top:0,left:0,background:"rgba(0,0,0,0.5)",zIndex:10},onMouseDown:s=>{s.target===s.currentTarget&&(o.onClose(),s.stopPropagation(),s.preventDefault())},children:n("div",{style:{width:"85vw",background:"var(--light)",position:"relative"},children:[n("div",{style:{display:"flex",justifyContent:"center",position:"relative",background:"var(--dark)",color:"var(--light)",padding:"0.5rem"},children:[n("h3",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.5rem"},children:o.title}),n("button",{onClick:()=>o.onClose(),style:{position:"absolute",right:"0.5rem",background:"none",border:"none"},children:n(D,{})})]}),n("div",{style:{height:"85dvh",overflowY:"auto"},children:o.children})]})})}function q(o,s,r,i){function a(e){return e instanceof r?e:new r(function(d){d(e)})}return new(r||(r=Promise))(function(e,d){function g(c){try{t(i.next(c))}catch(m){d(m)}}function f(c){try{t(i.throw(c))}catch(m){d(m)}}function t(c){c.done?e(c.value):a(c.value).then(g,f)}t((i=i.apply(o,s||[])).next())})}function V(o,s){var r={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,a,e,d;return d={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function g(t){return function(c){return f([t,c])}}function f(t){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,a&&(e=t[0]&2?a.return:t[0]?a.throw||((e=a.return)&&e.call(a),0):a.next)&&!(e=e.call(a,t[1])).done)return e;switch(a=0,e&&(t=[t[0]&2,e.value]),t[0]){case 0:case 1:e=t;break;case 4:return r.label++,{value:t[1],done:!1};case 5:r.label++,a=t[1],t=[0];continue;case 7:t=r.ops.pop(),r.trys.pop();continue;default:if(e=r.trys,!(e=e.length>0&&e[e.length-1])&&(t[0]===6||t[0]===2)){r=0;continue}if(t[0]===3&&(!e||t[1]>e[0]&&t[1]<e[3])){r.label=t[1];break}if(t[0]===6&&r.label<e[1]){r.label=e[1],e=t;break}if(e&&r.label<e[2]){r.label=e[2],r.ops.push(t);break}e[2]&&r.ops.pop(),r.trys.pop();continue}t=s.call(o,r)}catch(c){t=[6,c],a=0}finally{i=e=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}var Y=function(){var o=y(),s=o[0],r=o[1],i=y(!1),a=i[0],e=i[1],d=y(),g=d[0],f=d[1],t=_(function(c,m,k){return q(void 0,void 0,void 0,function(){return V(this,function(w){return[2,new Promise(function(h,l){e(!0),r(void 0);var p=J(c,m,k);p.on("state_changed",function(u){f(u)},function(u){e(!1),r(u),h(void 0)},function(){e(!1),f(void 0),h({metadata:p.snapshot.metadata,ref:p.snapshot.ref})})})]})})},[]);return[t,a,g,s]};const K=F({$nest:{"&::file-selector-button":{marginRight:"20px",padding:"0.5rem 1rem",background:"var(--cta)",border:"1px solid var(--cta-border)",borderRadius:"0.25rem",color:"white",cursor:"pointer",transition:"background .2s ease-in-out"},"&::file-selector-button:hover":{background:"var(--cta-hover)"}}});function Q(o){const s=G(U),r=x(null),[i,a]=y(),[e,d,g,f]=Y();return n("div",{style:{display:"flex",justifyContent:"center"},children:n("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexWrap:"wrap",gap:"1rem",margin:"1rem"},children:[n("div",{children:n("input",{id:"file",type:"file",accept:"image/*",ref:r,onChange:t=>{const c=t.target.files?t.target.files[0]:void 0;a(c)},className:K,disabled:d})}),n(v,{icon:n(T,{}),disabled:d||!i,onClick:async()=>{if(i){const t=M(s,"images/"+i.name);try{await e(t,i,{contentType:i.type}),r.current&&(r.current.value=""),a(void 0)}catch(c){console.error(c)}o.reloadFiles()}},children:"Upload Image"}),d&&n(j,{})]})})}const X=F({width:"10rem",height:"10rem",padding:"0.25rem",marginBottom:"0.5rem",background:"transparent",border:"1px solid",borderRadius:"0.5rem",$nest:{"&:hover":{background:"lightgrey"},"& img":{width:"100%",height:"100%",objectFit:"cover",borderRadius:"0.5rem"}}});function Z(o){const s=x(null),[r,i]=B("images/",o.reloadCounter),[a,e]=S.use(),[d,g]=y(!1);if(!a)return null;const[f,t,c,m,k]=E(a.ref),[w,h]=y([]);return R(()=>{if(!f||!a.multi){h([]);return}try{const l=JSON.parse(f||"");h(l)}catch(l){console.error(l),h([])}},[f]),n("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[n("div",{style:{borderBottom:"1px solid #bbb",width:"80%",margin:"0 0 1rem",textAlign:"center"}}),!i&&r.length>0&&a.multi&&n(v,{icon:n(L,{}),buttonType:"success",onClick:()=>{m(JSON.stringify(w)),e(void 0)},style:{margin:"0.75rem"},disabled:!d||k,children:"Save Selected Images"}),n("div",{ref:s,style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:"1rem",padding:"0.75rem"},children:[i&&n("div",{children:"Loading Images..."}),!i&&r.length===0&&n("div",{children:"No Images Have Been Uploaded"}),!i&&r.map(l=>{const p=x(null);return n("div",{style:{display:"flex",flexDirection:"column"},children:[n("button",{className:X,onClick:u=>{a.multi&&p.current?p.current.click():(m(JSON.stringify({url:C(l.path,I.Large,!0),itemPath:l.ref.fullPath})),e(void 0))},style:{position:"relative"},title:l.name,children:[a.multi&&n("input",{type:"checkbox",ref:p,onClick:u=>{u.stopPropagation(),g(!0),h(b=>u.target.checked?[...b,{url:C(l.path,I.Large,!0),thumbnail:l.thumbnail,itemPath:l.ref.fullPath}]:b.filter(P=>P.url!==l.url))},style:{position:"absolute",top:"0.25rem",right:"0.25rem"},"data-url":l.url,"data-thumbnail":l.thumbnail,"data-item-path":l.ref.fullPath,checked:w.some(u=>u.url===l.url)}),n("img",{src:l.thumbnail,loading:"lazy",onError:u=>setTimeout(()=>{u.target.src="",u.target.src=l.thumbnail},1500)})]}),n("div",{style:{display:"flex",gap:"0.25rem"},children:[n(v,{icon:n(N,{}),onClick:()=>window.open(l.url,"_blank"),style:{width:"100%",padding:"0.25rem"},title:"Download Image"}),n(v,{icon:n(O,{}),buttonType:"destructive",onClick:async()=>{if(confirm("Are you sure you want to delete this image?")){const u=z(l.ref);await Promise.all(u.map(b=>W(b))),o.setReloadCounter(o.reloadCounter+1)}},style:{width:"100%",padding:"0.25rem"},title:"Delete Image"})]})]},l.url)})]})]})}function ae(){const[o,s]=S.use(),[r,i]=y(0);return o?n($,{title:n(A,{children:["Choose an Image ",n(H,{})]}),onClose:()=>s(void 0),children:[n(Q,{reloadFiles:()=>i(()=>r+1)}),n(Z,{reloadCounter:r,setReloadCounter:i})]}):null}export{ae as FilePicker};
