import{s as C,m as S,b as P,p as F,o as n,F as D,h as p,T,_ as x,I as w,c as _,d as j,a as B,f as N,g as I,i as U,j as E,k as H,S as L,l as A,n as O,q as z,r as J}from"./index-502f5e87.js";import{u as W,g as G,r as M,d as $}from"./firebase_storage-4f68f3a5.js";import"./firebase_database-4955b4c5.js";import"./firebase_app-23be643a.js";import"./firebase_auth-f63cb495.js";const q=C({display:"flex",flexDirection:"column",maxHeight:"90vh",width:"85vw",background:"var(--light)",position:"relative"},S({maxWidth:P},{width:"100vw",height:"100dvh",maxHeight:"100dvh"}));function V(l){return F(()=>{const s=r=>{r.key==="Escape"&&l.onClose()};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[]),n("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100vw",height:"100dvh",position:"absolute",top:0,left:0,background:"rgba(0,0,0,0.5)",zIndex:10},onMouseDown:s=>{s.target===s.currentTarget&&(l.onClose(),s.stopPropagation(),s.preventDefault())},children:n("div",{className:q,children:[n("div",{style:{display:"flex",justifyContent:"center",position:"relative",background:"var(--dark)",color:"var(--light)",padding:"0.5rem"},children:[n("h3",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.5rem"},children:l.title}),n("button",{onClick:()=>l.onClose(),style:{position:"absolute",right:"0.5rem",background:"none",border:"none"},children:n(D,{})})]}),n("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:l.children})]})})}function Y(l,s,r,a){function i(e){return e instanceof r?e:new r(function(c){c(e)})}return new(r||(r=Promise))(function(e,c){function m(u){try{t(a.next(u))}catch(h){c(h)}}function f(u){try{t(a.throw(u))}catch(h){c(h)}}function t(u){u.done?e(u.value):i(u.value).then(m,f)}t((a=a.apply(l,s||[])).next())})}function K(l,s){var r={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},a,i,e,c;return c={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function m(t){return function(u){return f([t,u])}}function f(t){if(a)throw new TypeError("Generator is already executing.");for(;r;)try{if(a=1,i&&(e=t[0]&2?i.return:t[0]?i.throw||((e=i.return)&&e.call(i),0):i.next)&&!(e=e.call(i,t[1])).done)return e;switch(i=0,e&&(t=[t[0]&2,e.value]),t[0]){case 0:case 1:e=t;break;case 4:return r.label++,{value:t[1],done:!1};case 5:r.label++,i=t[1],t=[0];continue;case 7:t=r.ops.pop(),r.trys.pop();continue;default:if(e=r.trys,!(e=e.length>0&&e[e.length-1])&&(t[0]===6||t[0]===2)){r=0;continue}if(t[0]===3&&(!e||t[1]>e[0]&&t[1]<e[3])){r.label=t[1];break}if(t[0]===6&&r.label<e[1]){r.label=e[1],e=t;break}if(e&&r.label<e[2]){r.label=e[2],r.ops.push(t);break}e[2]&&r.ops.pop(),r.trys.pop();continue}t=s.call(l,r)}catch(u){t=[6,u],i=0}finally{a=e=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}var Q=function(){var l=p(),s=l[0],r=l[1],a=p(!1),i=a[0],e=a[1],c=p(),m=c[0],f=c[1],t=T(function(u,h,v){return Y(void 0,void 0,void 0,function(){return K(this,function(k){return[2,new Promise(function(g,o){e(!0),r(void 0);var y=W(u,h,v);y.on("state_changed",function(d){f(d)},function(d){e(!1),r(d),g(void 0)},function(){e(!1),f(void 0),g({metadata:y.snapshot.metadata,ref:y.snapshot.ref})})})]})})},[]);return[t,i,m,s]};const X=C({$nest:{"&::file-selector-button":{marginRight:"20px",padding:"0.5rem 1rem",background:"var(--cta)",border:"1px solid var(--cta-border)",borderRadius:"0.25rem",color:"white",cursor:"pointer",transition:"background .2s ease-in-out"},"&::file-selector-button:hover":{background:"var(--cta-hover)"}}});function Z(l){const s=G(B),r=x(null),[a,i]=p([]),[e,c,m,f]=Q();return n("div",{style:{display:"flex",justifyContent:"center"},children:n("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexWrap:"wrap",gap:"1rem",margin:"1rem"},children:[n("div",{children:n("input",{id:"file",type:"file",accept:"image/*",ref:r,onChange:t=>{i(Array.from(t.target.files||[]))},className:X,disabled:c,multiple:!0})}),n(w,{icon:n(_,{}),disabled:c||a.length===0,onClick:async()=>{for(const t of a){const u=M(s,"images/"+t.name);try{await e(u,t,{contentType:t.type})}catch(h){console.error(h)}}setTimeout(()=>{r.current&&(r.current.value=""),i([]),l.reloadFiles()},3e3)},children:["Upload Image",a.length>1&&"s"]}),c&&n(j,{})]})})}const ee=C({width:"10rem",height:"10rem",padding:"0",marginBottom:"0.5rem",background:"transparent",border:"1px solid",borderRadius:"0.5rem",$nest:{"&:hover":{filter:"brightness(0.8)"},"& img":{width:"100%",height:"100%",objectFit:"cover",borderRadius:"0.5rem"}}});function te(l){const s=x(null),[r,a]=N("images/",l.reloadCounter),[i,e]=I.use(),[c,m]=p(!1);if(!i)return null;const[f,t,u,h,v]=U(i.ref),[k,g]=p([]);return F(()=>{if(!f||!i.multi){g([]);return}try{const o=JSON.parse(f||"");g(o)}catch(o){console.error(o),g([])}},[f]),n("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[n("div",{style:{borderBottom:"1px solid #bbb",width:"80%",margin:"0 0 1rem",textAlign:"center"}}),!a&&r.length>0&&i.multi&&n(w,{icon:n(E,{}),buttonType:"success",onClick:()=>{h(JSON.stringify(k)),e(void 0)},style:{margin:"0.75rem"},disabled:!c||v,children:"Save Selected Images"}),n("div",{ref:s,style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:"1rem"},children:[a&&n("div",{children:"Loading Images..."}),!a&&r.length===0&&n("div",{children:"No Images Have Been Uploaded"}),!a&&r.map(o=>{const y=x(null);return n("div",{style:{display:"flex",flexDirection:"column"},children:[n("button",{className:ee,onClick:d=>{i.multi&&y.current?y.current.click():(h(JSON.stringify({url:H(o.path,L.Large,!0),itemPath:o.ref.fullPath})),e(void 0))},style:{position:"relative"},title:o.name,children:[i.multi&&n("input",{type:"checkbox",ref:y,onClick:d=>{d.stopPropagation(),m(!0),g(b=>d.target.checked?[...b,{url:o.url,thumbnail:o.thumbnail,itemPath:o.ref.fullPath}]:b.filter(R=>R.url!==o.url))},style:{position:"absolute",top:"0.25rem",right:"0.25rem"},"data-url":o.url,"data-thumbnail":o.thumbnail,"data-item-path":o.ref.fullPath,checked:k.some(d=>d.url===o.url)}),n("img",{src:o.thumbnail,loading:"lazy",onError:d=>setTimeout(()=>{d.target.src="",d.target.src=o.thumbnail},1500)})]}),n("div",{style:{display:"flex",gap:"0.25rem",justifyContent:"center"},children:n(w,{icon:n(A,{}),buttonType:"destructive",onClick:async()=>{if(confirm("Are you sure you want to delete this image?")){const d=O(o.ref);await Promise.all(d.map(b=>$(b))),l.setReloadCounter(l.reloadCounter+1)}},style:{padding:"0.35rem 1.25rem",height:"1.5rem"},title:"Delete Image"})})]},o.url)})]})]})}function oe(){const[l,s]=I.use(),[r,a]=p(0);return l?n(V,{title:n(z,{children:["Choose an Image ",n(J,{})]}),onClose:()=>s(void 0),children:[n(Z,{reloadFiles:()=>a(()=>r+1)}),n(te,{reloadCounter:r,setReloadCounter:a})]}):null}export{oe as FilePicker};
