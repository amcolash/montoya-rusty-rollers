import{o as O,b as h,r as S,s as j,a as q}from"./firebase_database-d5d358c6.js";import{F as b,p as g,s as w,T as v,_ as T,h as V}from"./lightbox-778a0ebd.js";import{d as x}from"./firebase-7334874f.js";import{e as F,C as m,E as p}from"./index-1d4b8e8e.js";import"./firebase_app-5c6bc232.js";var l=function(){return l=Object.assign||function(r){for(var t,n=1,u=arguments.length;n<u;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a])}return r},l.apply(this,arguments)},_=function(e){return{loading:e==null,value:e}},L=function(){return function(e,r){switch(r.type){case"error":return l(l({},e),{error:r.error,loading:!1,value:void 0});case"reset":return _(r.defaultValue);case"value":return l(l({},e),{error:void 0,loading:!1,value:r.value});default:return e}}},k=function(e){var r=e?e():void 0,t=w(L(),_(r)),n=t[0],u=t[1],a=v(function(){var i=e?e():void 0;u({type:"reset",defaultValue:i})},[e]),o=v(function(i){u({type:"error",error:i})},[]),s=v(function(i){u({type:"value",value:i})},[]);return b(function(){return{error:n.error,loading:n.loading,reset:a,setError:o,setValue:s,value:n.value}},[n.error,n.loading,a,o,s,n.value])},A=function(e,r,t){var n=T(e);return g(function(){r(e,n.current)||(n.current=e,t&&t())}),n},N=function(e,r){var t=!e&&!r,n=!!e&&!!r&&e.isEqual(r);return t||n},P=function(e,r){return A(e,N,r)},d=function(){return d=Object.assign||function(r){for(var t,n=1,u=arguments.length;n<u;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a])}return r},d.apply(this,arguments)},R=function(e){return e!=null&&typeof e=="object"&&Array.isArray(e)===!1},$=function(e,r,t,n){var u,a;if(e.exists){var o=e.val();return R(o)?d(d(d({},n?n(o):o),r?(u={},u[r]=e.key,u):null),t?(a={},a[t]=e.ref,a):null):n?n(o):o}},C=function(e){var r=k(),t=r.error,n=r.loading,u=r.reset,a=r.setError,o=r.setValue,s=r.value,i=P(e,u);return g(function(){var f=i.current;if(!f){o(void 0);return}return O(f,o,a),function(){h(f,"value",o)}},[i.current]),[s,n,t]},D=function(e,r){var t=r??{},n=t.keyField,u=t.refField,a=t.transform,o=C(e),s=o[0],i=o[1],f=o[2],c=b(function(){return s?$(s,n,u,a):void 0},[s,n,u,a]);return[c,i,f]};console.log("Loaded dynamic db");function J(e){const r=S(x,e),[t,n,u]=D(r,{}),[a,o]=V(!1),[s,i]=F.use();g(()=>{n?m.push(r.toString()):m.splice(m.indexOf(r.toString()),1)},[n]),g(()=>{u&&i(p.Error)},[u]);const f=v(async c=>{if(c===t)return;const E=Date.now();o(!0),i(p.Saving),c?await j(r,c):await q(r);const y=Date.now()-E;setTimeout(()=>{o(!1),i(p.None)},y<500?500-y:0)},[t,r]);return[t,n,u,f,a]}export{J as useDynamicDb};
