import{s as C,m as S,b as P,p as F,o as n,F as D,h as p,T,_ as x,I as w,c as _,d as j,a as B,f as N,g as I,i as U,j as E,k as H,S as L,l as O,n as z,q as A,r as J}from"./index-bb589fe4.js";import{u as W,g as G,r as M,d as $}from"./firebase_storage-4f68f3a5.js";import"./firebase_database-4955b4c5.js";import"./firebase_app-23be643a.js";import"./firebase_auth-f63cb495.js";const q=C({display:"flex",flexDirection:"column",maxHeight:"90vh",width:"85vw",background:"var(--light)",position:"relative"},S({maxWidth:P},{width:"100vw",height:"100dvh",maxHeight:"100dvh"}));function V(l){return F(()=>{const s=r=>{r.key==="Escape"&&l.onClose()};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[]),n("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100vw",height:"100dvh",position:"absolute",top:0,left:0,background:"rgba(0,0,0,0.5)",zIndex:10},onMouseDown:s=>{s.target===s.currentTarget&&(l.onClose(),s.stopPropagation(),s.preventDefault())},children:n("div",{className:q,children:[n("div",{style:{display:"flex",justifyContent:"center",position:"relative",background:"var(--dark)",color:"var(--light)",padding:"0.5rem"},children:[n("h3",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.5rem"},children:l.title}),n("button",{onClick:()=>l.onClose(),style:{position:"absolute",right:"0.5rem",background:"none",border:"none"},children:n(D,{})})]}),n("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:l.children})]})})}function Y(l,s,r,i){function a(e){return e instanceof r?e:new r(function(u){u(e)})}return new(r||(r=Promise))(function(e,u){function m(c){try{t(i.next(c))}catch(h){u(h)}}function f(c){try{t(i.throw(c))}catch(h){u(h)}}function t(c){c.done?e(c.value):a(c.value).then(m,f)}t((i=i.apply(l,s||[])).next())})}function K(l,s){var r={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,a,e,u;return u={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function m(t){return function(c){return f([t,c])}}function f(t){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,a&&(e=t[0]&2?a.return:t[0]?a.throw||((e=a.return)&&e.call(a),0):a.next)&&!(e=e.call(a,t[1])).done)return e;switch(a=0,e&&(t=[t[0]&2,e.value]),t[0]){case 0:case 1:e=t;break;case 4:return r.label++,{value:t[1],done:!1};case 5:r.label++,a=t[1],t=[0];continue;case 7:t=r.ops.pop(),r.trys.pop();continue;default:if(e=r.trys,!(e=e.length>0&&e[e.length-1])&&(t[0]===6||t[0]===2)){r=0;continue}if(t[0]===3&&(!e||t[1]>e[0]&&t[1]<e[3])){r.label=t[1];break}if(t[0]===6&&r.label<e[1]){r.label=e[1],e=t;break}if(e&&r.label<e[2]){r.label=e[2],r.ops.push(t);break}e[2]&&r.ops.pop(),r.trys.pop();continue}t=s.call(l,r)}catch(c){t=[6,c],a=0}finally{i=e=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}var Q=function(){var l=p(),s=l[0],r=l[1],i=p(!1),a=i[0],e=i[1],u=p(),m=u[0],f=u[1],t=T(function(c,h,v){return Y(void 0,void 0,void 0,function(){return K(this,function(k){return[2,new Promise(function(g,o){e(!0),r(void 0);var y=W(c,h,v);y.on("state_changed",function(d){f(d)},function(d){e(!1),r(d),g(void 0)},function(){e(!1),f(void 0),g({metadata:y.snapshot.metadata,ref:y.snapshot.ref})})})]})})},[]);return[t,a,m,s]};const X=C({$nest:{"&::file-selector-button":{marginRight:"20px",padding:"0.5rem 1rem",background:"var(--cta)",border:"1px solid var(--cta-border)",borderRadius:"0.25rem",color:"white",cursor:"pointer",transition:"background .2s ease-in-out"},"&::file-selector-button:hover":{background:"var(--cta-hover)"}}});function Z(l){const s=G(B),r=x(null),[i,a]=p(),[e,u,m,f]=Q();return n("div",{style:{display:"flex",justifyContent:"center"},children:n("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexWrap:"wrap",gap:"1rem",margin:"1rem"},children:[n("div",{children:n("input",{id:"file",type:"file",accept:"image/*",ref:r,onChange:t=>{const c=t.target.files?t.target.files[0]:void 0;a(c)},className:X,disabled:u})}),n(w,{icon:n(_,{}),disabled:u||!i,onClick:async()=>{if(i){const t=M(s,"images/"+i.name);try{await e(t,i,{contentType:i.type}),setTimeout(()=>{r.current&&(r.current.value=""),a(void 0)},3e3)}catch(c){console.error(c)}l.reloadFiles()}},children:"Upload Image"}),u&&n(j,{})]})})}const ee=C({width:"10rem",height:"10rem",padding:"0",marginBottom:"0.5rem",background:"transparent",border:"1px solid",borderRadius:"0.5rem",$nest:{"&:hover":{filter:"brightness(0.8)"},"& img":{width:"100%",height:"100%",objectFit:"cover",borderRadius:"0.5rem"}}});function te(l){const s=x(null),[r,i]=N("images/",l.reloadCounter),[a,e]=I.use(),[u,m]=p(!1);if(!a)return null;const[f,t,c,h,v]=U(a.ref),[k,g]=p([]);return F(()=>{if(!f||!a.multi){g([]);return}try{const o=JSON.parse(f||"");g(o)}catch(o){console.error(o),g([])}},[f]),n("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[n("div",{style:{borderBottom:"1px solid #bbb",width:"80%",margin:"0 0 1rem",textAlign:"center"}}),!i&&r.length>0&&a.multi&&n(w,{icon:n(E,{}),buttonType:"success",onClick:()=>{h(JSON.stringify(k)),e(void 0)},style:{margin:"0.75rem"},disabled:!u||v,children:"Save Selected Images"}),n("div",{ref:s,style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:"1rem"},children:[i&&n("div",{children:"Loading Images..."}),!i&&r.length===0&&n("div",{children:"No Images Have Been Uploaded"}),!i&&r.map(o=>{const y=x(null);return n("div",{style:{display:"flex",flexDirection:"column"},children:[n("button",{className:ee,onClick:d=>{a.multi&&y.current?y.current.click():(h(JSON.stringify({url:H(o.path,L.Large,!0),itemPath:o.ref.fullPath})),e(void 0))},style:{position:"relative"},title:o.name,children:[a.multi&&n("input",{type:"checkbox",ref:y,onClick:d=>{d.stopPropagation(),m(!0),g(b=>d.target.checked?[...b,{url:o.url,thumbnail:o.thumbnail,itemPath:o.ref.fullPath}]:b.filter(R=>R.url!==o.url))},style:{position:"absolute",top:"0.25rem",right:"0.25rem"},"data-url":o.url,"data-thumbnail":o.thumbnail,"data-item-path":o.ref.fullPath,checked:k.some(d=>d.url===o.url)}),n("img",{src:o.thumbnail,loading:"lazy",onError:d=>setTimeout(()=>{d.target.src="",d.target.src=o.thumbnail},1500)})]}),n("div",{style:{display:"flex",gap:"0.25rem",justifyContent:"center"},children:n(w,{icon:n(O,{}),buttonType:"destructive",onClick:async()=>{if(confirm("Are you sure you want to delete this image?")){const d=z(o.ref);await Promise.all(d.map(b=>$(b))),l.setReloadCounter(l.reloadCounter+1)}},style:{padding:"0.35rem 1.25rem",height:"1.5rem"},title:"Delete Image"})})]},o.url)})]})]})}function oe(){const[l,s]=I.use(),[r,i]=p(0);return l?n(V,{title:n(A,{children:["Choose an Image ",n(J,{})]}),onClose:()=>s(void 0),children:[n(Z,{reloadFiles:()=>i(()=>r+1)}),n(te,{reloadCounter:r,setReloadCounter:i})]}):null}export{oe as FilePicker};
