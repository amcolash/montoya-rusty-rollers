import{o as O,b as h,r as S,s as j,a as q}from"./firebase_database-d5d358c6.js";import{F as b,p as g,s as w,T as v,n as T,h as V,i as x,a2 as y,E as m}from"./index-c90a8d39.js";import{d as F}from"./firebase-7334874f.js";import"./firebase_app-5c6bc232.js";var l=function(){return l=Object.assign||function(r){for(var t,n=1,u=arguments.length;n<u;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a])}return r},l.apply(this,arguments)},_=function(e){return{loading:e==null,value:e}},L=function(){return function(e,r){switch(r.type){case"error":return l(l({},e),{error:r.error,loading:!1,value:void 0});case"reset":return _(r.defaultValue);case"value":return l(l({},e),{error:void 0,loading:!1,value:r.value});default:return e}}},k=function(e){var r=e?e():void 0,t=w(L(),_(r)),n=t[0],u=t[1],a=v(function(){var o=e?e():void 0;u({type:"reset",defaultValue:o})},[e]),i=v(function(o){u({type:"error",error:o})},[]),s=v(function(o){u({type:"value",value:o})},[]);return b(function(){return{error:n.error,loading:n.loading,reset:a,setError:i,setValue:s,value:n.value}},[n.error,n.loading,a,i,s,n.value])},A=function(e,r,t){var n=T(e);return g(function(){r(e,n.current)||(n.current=e,t&&t())}),n},N=function(e,r){var t=!e&&!r,n=!!e&&!!r&&e.isEqual(r);return t||n},P=function(e,r){return A(e,N,r)},d=function(){return d=Object.assign||function(r){for(var t,n=1,u=arguments.length;n<u;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a])}return r},d.apply(this,arguments)},R=function(e){return e!=null&&typeof e=="object"&&Array.isArray(e)===!1},$=function(e,r,t,n){var u,a;if(e.exists){var i=e.val();return R(i)?d(d(d({},n?n(i):i),r?(u={},u[r]=e.key,u):null),t?(a={},a[t]=e.ref,a):null):n?n(i):i}},D=function(e){var r=k(),t=r.error,n=r.loading,u=r.reset,a=r.setError,i=r.setValue,s=r.value,o=P(e,u);return g(function(){var f=o.current;if(!f){i(void 0);return}return O(f,i,a),function(){h(f,"value",i)}},[o.current]),[s,n,t]},I=function(e,r){var t=r??{},n=t.keyField,u=t.refField,a=t.transform,i=D(e),s=i[0],o=i[1],f=i[2],c=b(function(){return s?$(s,n,u,a):void 0},[s,n,u,a]);return[c,o,f]};console.log("Loaded dynamic db");function H(e){const r=S(F,e),[t,n,u]=I(r,{}),[a,i]=V(!1),[s,o]=x.use();g(()=>{n?y.push(r.toString()):y.splice(y.indexOf(r.toString()),1)},[n]),g(()=>{u&&o(m.Error)},[u]);const f=v(async c=>{if(c===t)return;const E=Date.now();i(!0),o(m.Saving),c?await j(r,c):await q(r);const p=Date.now()-E;setTimeout(()=>{i(!1),o(m.None)},p<500?500-p:0)},[t,r]);return[t,n,u,f,a]}export{H as useDynamicDb};
