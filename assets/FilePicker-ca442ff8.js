import{s as F,m as P,b as T,p as R,o as n,F as _,h as y,T as j,_ as w,I as C,c as B,d as N,a as U,f as E,g as S,i as A,j as H,k as L,S as O,l as z,n as J,q as M,r as W}from"./index-d2cd5377.js";import{u as G,g as $,r as q,d as V}from"./firebase_storage-4f68f3a5.js";import"./firebase_database-4955b4c5.js";import"./firebase_app-23be643a.js";import"./firebase_auth-f63cb495.js";const Y=F({display:"flex",flexDirection:"column",maxHeight:"90vh",width:"85vw",background:"var(--light)",position:"relative"},P({maxWidth:T},{width:"100vw",height:"100dvh",maxHeight:"100dvh"}));function K(u){return R(()=>{const l=r=>{r.key==="Escape"&&u.onClose()};return document.addEventListener("keydown",l),()=>document.removeEventListener("keydown",l)},[]),n("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100vw",height:"100dvh",position:"absolute",top:0,left:0,background:"rgba(0,0,0,0.5)",zIndex:10},onMouseDown:l=>{l.target===l.currentTarget&&(u.onClose(),l.stopPropagation(),l.preventDefault())},children:n("div",{className:Y,children:[n("div",{style:{display:"flex",justifyContent:"center",position:"relative",background:"var(--dark)",color:"var(--light)",padding:"0.5rem"},children:[n("h3",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.5rem"},children:u.title}),n("button",{onClick:()=>u.onClose(),style:{position:"absolute",right:"0.5rem",background:"none",border:"none"},children:n(_,{})})]}),n("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:u.children})]})})}function Q(u,l,r,o){function a(e){return e instanceof r?e:new r(function(s){s(e)})}return new(r||(r=Promise))(function(e,s){function f(c){try{t(o.next(c))}catch(h){s(h)}}function d(c){try{t(o.throw(c))}catch(h){s(h)}}function t(c){c.done?e(c.value):a(c.value).then(f,d)}t((o=o.apply(u,l||[])).next())})}function X(u,l){var r={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},o,a,e,s;return s={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function f(t){return function(c){return d([t,c])}}function d(t){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,a&&(e=t[0]&2?a.return:t[0]?a.throw||((e=a.return)&&e.call(a),0):a.next)&&!(e=e.call(a,t[1])).done)return e;switch(a=0,e&&(t=[t[0]&2,e.value]),t[0]){case 0:case 1:e=t;break;case 4:return r.label++,{value:t[1],done:!1};case 5:r.label++,a=t[1],t=[0];continue;case 7:t=r.ops.pop(),r.trys.pop();continue;default:if(e=r.trys,!(e=e.length>0&&e[e.length-1])&&(t[0]===6||t[0]===2)){r=0;continue}if(t[0]===3&&(!e||t[1]>e[0]&&t[1]<e[3])){r.label=t[1];break}if(t[0]===6&&r.label<e[1]){r.label=e[1],e=t;break}if(e&&r.label<e[2]){r.label=e[2],r.ops.push(t);break}e[2]&&r.ops.pop(),r.trys.pop();continue}t=l.call(u,r)}catch(c){t=[6,c],a=0}finally{o=e=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}var Z=function(){var u=y(),l=u[0],r=u[1],o=y(!1),a=o[0],e=o[1],s=y(),f=s[0],d=s[1],t=j(function(c,h,I){return Q(void 0,void 0,void 0,function(){return X(this,function(v){return[2,new Promise(function(p,k){e(!0),r(void 0);var g=G(c,h,I);g.on("state_changed",function(i){d(i)},function(i){e(!1),r(i),p(void 0)},function(){e(!1),d(void 0),p({metadata:g.snapshot.metadata,ref:g.snapshot.ref})})})]})})},[]);return[t,a,f,l]};const ee=F({$nest:{"&::file-selector-button":{marginRight:"20px",padding:"0.5rem 1rem",background:"var(--cta)",border:"1px solid var(--cta-border)",borderRadius:"0.25rem",color:"white",cursor:"pointer",transition:"background .2s ease-in-out"},"&::file-selector-button:hover":{background:"var(--cta-hover)"}}});function te(u){const l=$(U),r=w(null),[o,a]=y([]),[e,s,f,d]=Z();return n("div",{style:{display:"flex",justifyContent:"center"},children:n("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexWrap:"wrap",gap:"1rem",margin:"1rem"},children:[n("div",{children:n("input",{id:"file",type:"file",accept:"image/*",ref:r,onChange:t=>{a(Array.from(t.target.files||[]))},className:ee,disabled:s,multiple:!0})}),n(C,{icon:n(B,{}),disabled:s||o.length===0,onClick:async()=>{for(const t of o){const c=q(l,"images/"+t.name);try{await e(c,t,{contentType:t.type})}catch(h){console.error(h)}}setTimeout(()=>{r.current&&(r.current.value=""),a([]),u.reloadFiles()},3e3)},children:["Upload Image",o.length>1&&"s"]}),s&&n(N,{})]})})}const re=F({width:"10rem",height:"10rem",padding:"0",marginBottom:"0.5rem",background:"transparent",border:"1px solid",borderRadius:"0.5rem",$nest:{"&:hover":{filter:"brightness(0.8)"},"& img":{width:"100%",height:"100%",objectFit:"cover",borderRadius:"0.5rem"}}});function ne(u){const{reloadCounter:l,setReloadCounter:r,multiDirty:o,setMultiDirty:a}=u,e=w(null),[s,f]=E("images/",l),[d,t]=S.use();if(!d)return null;const[c,h,I,v,p]=A(d.ref),[k,g]=y([]);return R(()=>{if(!c||!d.multi){g([]);return}try{const i=JSON.parse(c||"");g(i)}catch(i){console.error(i),g([])}},[c]),n("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[n("div",{style:{borderBottom:"1px solid #bbb",width:"80%",margin:"0 0 1rem",textAlign:"center"}}),!f&&s.length>0&&d.multi&&n(C,{icon:n(H,{}),buttonType:"success",onClick:()=>{v(JSON.stringify(k)),t(void 0)},style:{margin:"0.75rem"},disabled:!o||p,children:"Save Selected Images"}),n("div",{ref:e,style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:"1rem"},children:[f&&n("div",{children:"Loading Images..."}),!f&&s.length===0&&n("div",{children:"No Images Have Been Uploaded"}),!f&&s.map(i=>{const x=w(null);return n("div",{style:{display:"flex",flexDirection:"column"},children:[n("button",{className:re,onClick:m=>{d.multi&&x.current?x.current.click():(v(JSON.stringify({url:L(i.path,O.Large,!0),itemPath:i.ref.fullPath})),t(void 0))},style:{position:"relative"},title:i.name,children:[d.multi&&n("input",{type:"checkbox",ref:x,onClick:m=>{m.stopPropagation(),a(!0),g(b=>m.target.checked?[...b,{url:i.url,thumbnail:i.thumbnail,itemPath:i.ref.fullPath}]:b.filter(D=>D.url!==i.url))},style:{position:"absolute",top:"0.25rem",right:"0.25rem"},"data-url":i.url,"data-thumbnail":i.thumbnail,"data-item-path":i.ref.fullPath,checked:k.some(m=>m.url===i.url)}),n("img",{src:i.thumbnail,loading:"lazy",onError:m=>setTimeout(()=>{m.target.src="",m.target.src=i.thumbnail},1500)})]}),n("div",{style:{display:"flex",gap:"0.25rem",justifyContent:"center"},children:n(C,{icon:n(z,{}),buttonType:"destructive",onClick:async()=>{if(confirm("Are you sure you want to delete this image?")){const m=J(i.ref);await Promise.all(m.map(b=>V(b))),r(l+1)}},style:{padding:"0.35rem 1.25rem",height:"1.5rem"},title:"Delete Image"})})]},i.url)})]})]})}function ce(){const[u,l]=S.use(),[r,o]=y(0),[a,e]=y(!1);return u?n(K,{title:n(M,{children:["Choose an Image ",n(W,{})]}),onClose:()=>{a&&!confirm("Changes you have made may not be saved. Are you sure you want to exit?")||l(void 0)},children:[n(te,{reloadFiles:()=>o(()=>r+1)}),n(ne,{reloadCounter:r,setReloadCounter:o,multiDirty:a,setMultiDirty:e})]}):null}export{ce as FilePicker};
