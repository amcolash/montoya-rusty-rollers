import{b as w,r as T}from"./firebase_database-a9302d9a.js";import{s as E,m as W,b as q,p as U,o as e,F as G,_ as F,h as v,c as O,I as x,d as Y,f as _,a as $,g as J,i as B,j as A,k as K,l as Q,n as X,S as Z,q as ee,r as te,t as re,v as R,w as P,x as D,y as M,z as ie,C as ae}from"./index-97e8ddf7.js";import{g as H,r as L,d as ne}from"./firebase_storage-3b718f90.js";import"./firebase_app-8d4ba75c.js";import"./firebase_auth-ecfe032f.js";const le=E({display:"flex",flexDirection:"column",maxHeight:"90vh",width:"85vw",background:"var(--light)",position:"relative"},W({maxWidth:q},{width:"100vw",height:"100dvh",maxHeight:"100dvh"}));function oe(a){return U(()=>{const i=o=>{o.key==="Escape"&&a.onClose()};return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[]),e("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100vw",height:"100dvh",position:"absolute",top:0,left:0,background:"rgba(0,0,0,0.5)",zIndex:10},onMouseDown:i=>{i.target===i.currentTarget&&(a.onClose(),i.stopPropagation(),i.preventDefault())},children:e("div",{className:le,children:[e("div",{style:{display:"flex",justifyContent:"center",position:"relative",background:"var(--dark)",color:"var(--light)",padding:"0.5rem"},children:[e("h3",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.5rem"},children:a.title}),e("button",{onClick:()=>a.onClose(),style:{position:"absolute",right:"0.5rem",background:"none",border:"none"},children:e(G,{})})]}),e("div",{style:{flex:1,overflowY:"auto",padding:"1rem"},children:a.children})]})})}const se=E({$nest:{"&::file-selector-button":{marginRight:"20px",padding:"0.5rem 1rem",background:"var(--cta)",border:"1px solid var(--cta-border)",borderRadius:"0.25rem",color:"white",cursor:"pointer",transition:"background .2s ease-in-out"},"&::file-selector-button:hover":{background:"var(--cta-hover)"}}});function ce(a){const i=H($),o=F(null),[s,c]=v([]),[f,n,d,u]=O();return e("div",{style:{display:"flex",justifyContent:"center"},children:e("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:"1rem",margin:"1rem"},children:[e("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:[e("input",{id:"file",type:"file",accept:"image/*",ref:o,onChange:r=>{c(Array.from(r.target.files||[]))},className:se,disabled:n,multiple:!0}),e(x,{icon:e(Y,{}),disabled:n||s.length===0,style:{whiteSpace:"nowrap"},onClick:async()=>{for(const r of s){const p=L(i,"images/"+r.name);try{await f(p,r,{contentType:r.type})}catch(m){console.error(m)}}setTimeout(()=>{o.current&&(o.current.value=""),c([]),a.reloadFiles()},3e3)},children:["Upload Image",s.length>1&&"s"]})]}),n&&e(_,{})]})})}const de=E({width:"10rem",height:"10rem",padding:"0",marginBottom:"0.5rem",background:"transparent",border:"1px solid",borderRadius:"0.5rem",$nest:{"&:hover":{filter:"brightness(0.8)"},"& img":{width:"100%",height:"100%",objectFit:"cover",borderRadius:"0.5rem"}}});function ue(a){const{reloadCounter:i,setReloadCounter:o,multiDirty:s,setMultiDirty:c,setEditing:f}=a,n=F(null),[d,u]=J("images/",i),[r,p]=B.use();if(!r)return null;const[m,S,z,g,y]=A(r.ref),[b,k]=v([]),{meta:j,getEditImageUrl:N}=K(),V=H($);return U(()=>{if(!m||!r.multi){k([]);return}try{k(m)}catch(t){console.error(t),k([])}},[m]),e("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e("div",{style:{borderBottom:"1px solid #bbb",width:"80%",margin:"0 0 1rem",textAlign:"center"}}),!u&&d.length>0&&r.multi&&e(x,{icon:e(Q,{}),buttonType:"success",onClick:()=>{g(b),p(void 0)},style:{margin:"0.75rem"},disabled:!s||y,children:"Save Selected Images"}),e("div",{ref:n,style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:"1rem"},children:[u&&e("div",{children:"Loading Images..."}),!u&&d.length===0&&e("div",{children:"No Images Have Been Uploaded"}),!u&&d.map(t=>{const I=F(null);return e("div",{style:{display:"flex",flexDirection:"column"},children:[e("button",{className:de,onClick:l=>{r.multi&&I.current?I.current.click():(g([{url:X(t.path,Z.Large,!0),itemPath:t.ref.fullPath}]),p(void 0))},style:{position:"relative"},title:t.name,children:[r.multi&&e("input",{type:"checkbox",ref:I,onClick:l=>{l.stopPropagation(),c(!0),k(h=>l.target.checked?[...h,{url:t.url,thumbnail:t.thumbnail,itemPath:t.ref.fullPath}]:h.filter(C=>C.url!==t.url))},style:{position:"absolute",top:"0.25rem",right:"0.25rem"},"data-url":t.url,"data-thumbnail":t.thumbnail,"data-item-path":t.ref.fullPath,checked:b.some(l=>l.url===t.url)}),e("img",{src:N(t.path,t.thumbnail),loading:"lazy",onError:l=>setTimeout(()=>{l.target.src="",l.target.src=t.thumbnail},1500)})]}),e("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"center"},children:[e(x,{icon:e(ee,{}),onClick:()=>f(t),style:{padding:"0.35rem 1.25rem",height:"1.5rem"},title:"Edit Image"}),e(x,{icon:e(te,{}),buttonType:"destructive",onClick:async()=>{if(confirm("Are you sure you want to delete this image?")){const l=re(t.ref);if(j&&j[R(t.path)]!==void 0){l.forEach(C=>{l.push(L(V,C.fullPath.replace("images/","images/cropped/")))});const h=w(D,`${P}/${R(t.path)}`);T(h)}await Promise.all(l.map(h=>ne(h))),o(i+1)}},style:{padding:"0.35rem 1.25rem",height:"1.5rem"},title:"Delete Image"})]})]},t.url)})]})]})}function ye(){const[a,i]=B.use(),[o,s]=v(0),[c,f]=v(!1),[n,d]=v(),u=w(D,P),[r,p,m,S,z]=A(u),g=R((n==null?void 0:n.path)||"");return a?e(oe,{title:e(M,{children:[n?"Editing Image":a.multi?"Choose Multiple Images":"Choose an Image"," ",e(ie,{})]}),onClose:()=>{c&&!confirm("Changes you have made may not be saved. Are you sure you want to exit?")||i(void 0)},children:n?e(ae,{file:n,initialMeta:r&&r[g],setMeta:y=>{if(y)S({...r,[g]:y});else{const b=w(D,`${P}/${g}`);T(b)}d(void 0)}}):e(M,{children:[e(ce,{reloadFiles:()=>s(()=>o+1)}),e(ue,{reloadCounter:o,multiDirty:c,setReloadCounter:s,setMultiDirty:f,setEditing:d,imageMeta:r})]})}):null}export{ye as FilePicker};
